{% extends 'layout.html' %}

{% block content %}
<h1 class="mb-4">{{ category.name }} ({{ category.code }})</h1>
<a class="btn btn-primary mb-3" href="{{ url_for('systems.add_system') }}">Add New System</a>
<table id="function-table" class="table table-striped table-hover">
  <thead>
    <tr>
      <th>System</th>
      <th>Subcategory</th>
      <th>Score</th>
      <th>Last Reviewed</th>
      <th>Notes</th>
    </tr>
  </thead>
  <tbody>
    {% for system, maps in system_map.items() %}
      {% for m in maps %}
      <tr>
        <td>
          <a href="{{ url_for('systems.system_detail', system_id=system.id) }}">
            {{ system.name }}
          </a>
        </td>
        <td>{{ m.subcategory.code }} - {{ m.subcategory.name }}</td>
        <td>{{ m.score }}</td>
        <td>{{ m.last_reviewed.strftime('%Y-%m-%d') if m.last_reviewed else 'N/A' }}</td>
        <td>{{ m.notes or 'â€”' }}</td>
      </tr>
      {% endfor %}
    {% endfor %}
  </tbody>
</table>

<a href="{{ url_for('dashboard.dashboard') }}" class="btn btn-secondary mt-3">Back to Dashboard</a>
{% block scripts %}
<script>
  $(document).ready(function() {
    $('#function-table').DataTable();
  });
</script>
{% endblock %}
{% endblock %}