{% extends 'layout.html' %}

{% block content %}
<h1>{{ system.name }}</h1>
<p><strong>Description:</strong> {{ system.description or 'N/A' }}</p>
<p><strong>Owner:</strong> {{ system.owner or 'N/A' }}</p>
<p><strong>Notes:</strong> {{ system.notes or 'N/A' }}</p>
<p><strong>Added On:</strong> {{ system.added_on.strftime('%Y-%m-%d') }}</p>

<div class="d-flex align-items-center justify-content-between mb-3">
  <div class="d-flex align-items-center gap-2">
    <a href="{{ url_for('mappings.add_mapping', system_id=system.id) }}"
       class="btn btn-primary">
      Add Mapping
    </a>
    <a href="{{ url_for('systems.edit_system', system_id=system.id) }}"
       class="btn btn-warning">
      Edit System
    </a>
  </div>
  <form method="POST"
        action="{{ url_for('systems.delete_system', system_id=system.id) }}"
        class="ms-auto"
        onsubmit="return confirm('Delete this system and all its mappings? This action cannot be undone.');">
    <button type="submit" class="btn btn-danger">
      Delete System
    </button>
  </form>
</div>

<hr>
<h2>Mappings</h2>
{% if system.mappings %}
  <table class="table table-bordered">
    <thead>
      <tr>
        <th>Subcategory</th>
        <th>Score</th>
        <th>Last Reviewed</th>
        <th>Reviewer</th>
        <th>Notes</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
    {% for mapping in system.mappings %}
      <tr>
        <td>{{ mapping.subcategory.code }} - {{ mapping.subcategory.name }}</td>
        <td>{{ mapping.score }}</td>
        <td>{{ mapping.last_reviewed.strftime('%Y-%m-%d') if mapping.last_reviewed else 'N/A' }}</td>
        <td>{{ mapping.reviewer or 'N/A' }}</td>
        <td>{{ mapping.notes or 'N/A' }}</td>
        <td>
          <a href="{{ url_for('mappings.edit_mapping', system_id=system.id, mapping_id=mapping.id) }}"
             class="btn btn-sm btn-primary me-1">
            Edit
          </a>
          <form method="POST"
                action="{{ url_for('mappings.delete_mapping', system_id=system.id, mapping_id=mapping.id) }}"
                class="d-inline"
                onsubmit="return confirm('Delete this mapping? This action cannot be undone.');">
            <button type="submit" class="btn btn-sm btn-danger">
              Delete
            </button>
          </form>
        </td>
      </tr>
    {% endfor %}
    </tbody>
  </table>
{% else %}
  <p>No mappings recorded for this system.</p>
{% endif %}

<a href="{{ url_for('systems.list_systems') }}" class="btn btn-secondary mt-3">Back to List</a>
{% endblock %}